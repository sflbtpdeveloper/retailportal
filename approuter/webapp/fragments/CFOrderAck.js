sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","zretail_sfl/formatter/formatter"],function(e,t,a,r,n,i){"use strict";return e.extend("zretail_sfl.fragments.CForderAck",{formatter:i,onInit:function(){debugger;this._localModel=this.getOwnerComponent().getModel("mainService");this._readData()},onFragmentLoaded:function(e){debugger;this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("operations").attachPatternMatched(this._onObjectMatched,this);this._localModel=this.getOwnerComponent().getModel("mainService");this._readData()},onBeforeRendering:function(){if(this.oRouter){this.oRouter.getRoute("operations").detachPatternMatched(this._onObjectMatched,this)}},onAfterRendering:function(){this.oRouter.getRoute("operations").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(){debugger;this.oRouter.getRoute("operations").detachPatternMatched(this._onObjectMatched,this);var e="zretail_sfl.fragments.front";var t="zretail_sfl.fragments.front";var a=this.getView();var r=a.getController();r.loadFragment(e,t)},_readData:async function(){debugger;this._userModel=this.getOwnerComponent().getModel("userModel");let e=localStorage.getItem("userInfo");if(e){let t=JSON.parse(e);this._userModel.setProperty("/",{email:t.email,user:t.user,scopes:t.scopes,given_name:t.user.given_name,family_name:t.user.family_name,user_name:t.user.user_name})}this._userModel=this.getOwnerComponent().getModel("userModel");var t=this._userModel.getProperty("/email");const a=JSON.parse(localStorage.getItem("divisionData"))||{};const r=a.selectedDivision||null;const n=a.selectedSflTile||false;const i=a.selectedTplTile||false;let s=null;let o=null;if(r){o=r}if(n){s="5010"}else if(i){s="6400"}const l={email:t,bukrs:s,spart:o};var d=this.getOwnerComponent().getModel("mainService");d.refreshMetadata();d.refresh(true);var c=this._sFragmentUniqueId;this.getView().byId(c+"--__OrderAckTable").setModel(d);sap.ui.core.BusyIndicator.show(0);this.getOwnerComponent().setModel(d,"mainService");const u=this;sap.ui.core.BusyIndicator.show();try{const e=await $.ajax({url:"/nodeapp/acklist",method:"GET",contentType:"application/json",data:l});sap.ui.core.BusyIndicator.hide();const t=e;console.log(t);var g=new sap.ui.model.json.JSONModel;g.setData(t);u.getView().setModel(g,"listModel")}catch(e){sap.ui.core.BusyIndicator.hide();console.error("Error fetching Ack List:",e);const t=e.responseJSON?.error?.innererror?.errordetails?.[0]?.message||"Unknown error occurred"}},onPlant:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderAckTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("Werks",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onSO:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderAckTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("Vbkur",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onSG:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderAckTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("Vkgrp",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onSotp:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderAckTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("Kunnr",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onShtp:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderAckTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("ShipParty",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onPO:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderAckTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("Bstkd",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onDAT:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderAckTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("Erdat",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onORD:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderAckTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("Vbeln",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onPart:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderAckTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("Matnr",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onDownloadExcel:function(){var e=this.getView().getModel("listModel");var t=e.getProperty("/");if(!t||t.length===0){sap.m.MessageBox.error("No records found to download.");return}var a=t.map(function(e){return{"Sales Office":e.Vbkur,"Sales Group":e.Vkgrp,Region:e.Regio,"Sold-to-Party":e.Kunnr,"Ship-to-Party":e.ShipParty,"PO Reference":e.Bstkd,"PO Date":e.Bstdk,"Sales Order No":e.Vbeln,Item:e.Posnr,"Order Date":e.Erdat,"Part Number":e.Matnr,"Part Description":e.Arktx,Quantity:e.Kwmeng,Plant:e.Werks,"Sales Value":e.Kzwi1,"Sold-to-Party Name":e.Name1,"Ship-to-Party Name":e.Cname1,"Entered Material":e.Matwa}});var r=this.convertToCsv(a);var n=new Blob([r],{type:"text/csv;charset=utf-8;"});var i=document.createElement("a");var s=URL.createObjectURL(n);i.setAttribute("href",s);i.setAttribute("download","OrderAck_data.csv");i.style.visibility="hidden";document.body.appendChild(i);i.click();document.body.removeChild(i)},convertToCsv:function(e){var t="";var a=Object.keys(e[0]);t+=a.join(",")+"\r\n";e.forEach(function(e){t+=a.map(function(t){return e[t]?e[t].toString().replace(/,/g," "):""}).join(",")+"\r\n"});return t},onOpenLayoutDialog:function(){var e=this.byId("layoutDialog");if(!e){e=sap.ui.xmlfragment("zretail_sfl.fragments.LayoutDialog",this);this.getView().addDependent(e)}e.open()},onCloseLayoutDialog:function(){this.byId("layoutDialog").close()},onColumnVisibilityChange:function(e){var t=e.getSource();var a=t.getText();var r;switch(a){case"Sales Office":r=this.byId("colSalesOffice");break;case"Sales Group":r=this.byId("colSalesGroup");break;case"Region":r=this.byId("colRegion");break;case"Sold-to-Party":r=this.byId("colSoldToParty");break;case"Ship-to-Party":r=this.byId("colShipToParty");break;case"PO Reference / PO Date":r=this.byId("colPO");break;case"Sales Order No / Item / Date":r=this.byId("colSalesOrder");break;case"Part Number / Desc":r=this.byId("colPartNumber");break;case"Quantity":r=this.byId("colQuantity");break;case"Plant":r=this.byId("colPlant");break;case"Sales Value":r=this.byId("colSalesValue");break;case"Sold-to-Party Name":r=this.byId("colSoldToName");break;case"Ship-to-Party Name":r=this.byId("colShipToName");break;case"Entered Material":r=this.byId("colEnteredMaterial");break;default:return}if(r){r.setVisible(t.getSelected())}}})});
//# sourceMappingURL=CFOrderAck.js.map