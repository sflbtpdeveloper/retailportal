sap.ui.define(["zretail_sfl/controller/BaseController","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","zretail_sfl/formatter/formatter"],function(e,t,r,a,n){"use strict";return e.extend("zretail_sfl.controller.OrderDes",{formatter:n,onInit:function(){debugger;this._localModel=this.getOwnerComponent().getModel("mainService");this._readData()},onFragmentLoaded:function(e){debugger;this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("operations").attachPatternMatched(this._onObjectMatched,this);this._localModel=this.getOwnerComponent().getModel("mainService");this._readData()},onBeforeRendering:function(){if(this.oRouter){this.oRouter.getRoute("operations").detachPatternMatched(this._onObjectMatched,this)}},onAfterRendering:function(){this.oRouter.getRoute("operations").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(){debugger;this.oRouter.getRoute("operations").detachPatternMatched(this._onObjectMatched,this);var e="zretail_sfl.fragments.front";var t="zretail_sfl.fragments.front";var r=this.getView();var a=r.getController();a.loadFragment(e,t)},_readData:async function(){debugger;this._userModel=this.getOwnerComponent().getModel("userModel");let e=localStorage.getItem("userInfo");if(e){let t=JSON.parse(e);this._userModel.setProperty("/",{email:t.email,user:t.user,scopes:t.scopes,given_name:t.user.given_name,family_name:t.user.family_name,user_name:t.user.user_name})}this._userModel=this.getOwnerComponent().getModel("userModel");var t=this._userModel.getProperty("/email");const r=JSON.parse(localStorage.getItem("divisionData"))||{};const a=r.selectedDivision||null;const n=r.selectedSflTile||false;const i=r.selectedTplTile||false;let o=null;let s=null;if(a){s=a}if(n){o="5010"}else if(i){o="6400"}const l={email:t,bukrs:o,spart:s};var d=this.getOwnerComponent().getModel("mainService");d.refreshMetadata();d.refresh(true);var g=this._sFragmentUniqueId;this.getView().byId(g+"--__OrderDesTable").setModel(d);sap.ui.core.BusyIndicator.show(0);this.getOwnerComponent().setModel(d,"mainService");const u=this;sap.ui.core.BusyIndicator.show();try{const e=await $.ajax({url:"/nodeapp/ordDeslist",method:"GET",contentType:"application/json",data:l});sap.ui.core.BusyIndicator.hide();const t=e;console.log(t);var c=new sap.ui.model.json.JSONModel;c.setData(t);u.getView().setModel(c,"listModel")}catch(e){sap.ui.core.BusyIndicator.hide();var c=new sap.ui.model.json.JSONModel;c.setData([]);u.getView().setModel(c,"listModel");console.error("Error fetching Order Dispatch List:",e);const t=e.responseJSON?.error?.innererror?.errordetails?.[0]?.message||"Unknown error occurred"}},onPlant:function(e){debugger;var t=this._sFragmentUniqueId;var n=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderDesTable");var o=i.getBinding("items");var s=[];if(n&&n.length>0){var l=new r("Werks",a.Contains,n);s.push(new r({filters:[l],and:false}))}o.filter(s)},onSO:function(e){debugger;var t=this._sFragmentUniqueId;var n=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderDesTable");var o=i.getBinding("items");var s=[];if(n&&n.length>0){var l=new r("Vbkur",a.Contains,n);s.push(new r({filters:[l],and:false}))}o.filter(s)},onSG:function(e){debugger;var t=this._sFragmentUniqueId;var n=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderDesTable");var o=i.getBinding("items");var s=[];if(n&&n.length>0){var l=new r("Vkgrp",a.Contains,n);s.push(new r({filters:[l],and:false}))}o.filter(s)},onSotp:function(e){debugger;var t=this._sFragmentUniqueId;var n=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderDesTable");var o=i.getBinding("items");var s=[];if(n&&n.length>0){var l=new r("Kunnr",a.Contains,n);s.push(new r({filters:[l],and:false}))}o.filter(s)},onShtp:function(e){debugger;var t=this._sFragmentUniqueId;var n=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderDesTable");var o=i.getBinding("items");var s=[];if(n&&n.length>0){var l=new r("ShipParty",a.Contains,n);s.push(new r({filters:[l],and:false}))}o.filter(s)},onPO:function(e){debugger;var t=this._sFragmentUniqueId;var n=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderDesTable");var o=i.getBinding("items");var s=[];if(n&&n.length>0){var l=new r("Bstkd",a.Contains,n);s.push(new r({filters:[l],and:false}))}o.filter(s)},onDAT:function(e){debugger;var t=this._sFragmentUniqueId;var n=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderDesTable");var o=i.getBinding("items");var s=[];if(n&&n.length>0){var l=new r("Bstdk",a.Contains,n);s.push(new r({filters:[l],and:false}))}o.filter(s)},onORD:function(e){debugger;var t=this._sFragmentUniqueId;var n=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderDesTable");var o=i.getBinding("items");var s=[];if(n&&n.length>0){var l=new r("SoNo",a.Contains,n);s.push(new r({filters:[l],and:false}))}o.filter(s)},onPart:function(e){debugger;var t=this._sFragmentUniqueId;var n=e.getParameter("newValue");var i=this.getView().byId(t+"--__OrderDesTable");var o=i.getBinding("items");var s=[];if(n&&n.length>0){var l=new r("Matnr",a.Contains,n);s.push(new r({filters:[l],and:false}))}o.filter(s)},onDownloadExcel:function(){var e=this.getView().getModel("listModel");var t=e.getProperty("/");if(!t||t.length===0){sap.m.MessageBox.error("No records found to download.");return}var r=t.map(function(e){return{"Sales Office":e.Vbkur,"Sales Group":e.Vkgrp,Region:e.Regio,City:e.Ort01,"Sold To":e.Kunnr,"Ship To":e.ShipParty,"PO Reference No":e.Bstkd,"PO Reference Date":e.Bstdk,"Sales Order No":e.SoNo,Item:e.Posnr,"Order Date":e.SoDt,"Invoice Number":e.InvNo,"Invoice Date":e.InvDat,"Sales Value":e.SalVal,Plant:e.Werks,"Material Number":e.Matnr,"Material Description":e.Arktx,Quantity:e.Kwmeng,"LR No":e.Lrno,"LR Date":e.Lrdate,"Transporter Name":e.Tname,"Secondary LR No":e.Slrno,"Secondary LR Date":e.Slrdate,"Secondary LR Transporter":e.Stname,"Invoice Value":e.InvVal,"Sold To Name":e.SoName,"Ship To Name":e.ShName,"IGST Amount":e.Igst,"SGST Amount":e.Sgst,"CGST Amount":e.Cgst,"Plant Name":e.Pname,"No. of Packs":e.Nop,"GRN No":e.Grnno,"GRN Date":e.Grndate,"Entered Material":e.Matent,"TCS Amount":e.Tcs,"Invoice Value with TCS":e.InvTcs}});var a=this.convertToCsv(r);var n=new Blob([a],{type:"text/csv;charset=utf-8;"});var i=document.createElement("a");var o=URL.createObjectURL(n);i.setAttribute("href",o);i.setAttribute("download","OrderDesp_data.csv");i.style.visibility="hidden";document.body.appendChild(i);i.click();document.body.removeChild(i)},convertToCsv:function(e){var t="";var r=Object.keys(e[0]);t+=r.join(",")+"\r\n";e.forEach(function(e){t+=r.map(function(t){return e[t]?e[t].toString().replace(/,/g," "):""}).join(",")+"\r\n"});return t}})});
//# sourceMappingURL=OrderDes.js.map