sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/odata/v2/ODataModel","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel"],function(e,t,r,s,a){"use strict";return e.extend("zretail_sfl.controller.TestCert",{onInit:function(){this._localModel=this.getOwnerComponent().getModel("local");this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("operations").attachPatternMatched(this._onObjectMatched,this)},onFragmentLoaded:function(e){debugger;this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("operations").attachPatternMatched(this._onObjectMatched,this);this._localModel=this.getOwnerComponent().getModel("mainService")},onInvoiceChange:async function(e){var t=this.getOwnerComponent().getModel("dropModel");t.setProperty("/SelectedKey","");if(t){t.setProperty("/items",[]);t.refresh(true)}var r=this.getOwnerComponent().getModel("dropHeat");r.setProperty("/SelectedKey","");if(r){r.setProperty("/items",[]);r.refresh(true)}var s=this._sFragmentUniqueId;var a=sap.ui.core.Fragment.byId(s,"HtNo");a.setSelectedKey("");var o=e.getParameter("value");this._userModel=this.getOwnerComponent().getModel("userModel");let n=localStorage.getItem("userInfo");if(n){let e=JSON.parse(n);this._userModel.setProperty("/",{email:e.email,user:e.user,scopes:e.scopes,given_name:e.user.given_name,family_name:e.user.family_name,user_name:e.user.user_name})}this._userModel=this.getOwnerComponent().getModel("userModel");var i=this._userModel.getProperty("/email");const l=JSON.parse(localStorage.getItem("divisionData"))||{};const d=l.selectedDivision||null;const u=l.selectedSflTile||false;const g=l.selectedTplTile||false;let c=null;let p=null;if(d){p=d}if(u){c="5010"}else if(g){c="6400"}let m=null;let h=null;let f=null;let v=null;var y=o+","+m+","+h+","+f+","+v+","+i+","+c+","+p;if(o.trim()===""){sap.m.MessageToast.show("Please enter Invoice")}else{try{await this.validateData(y)}catch(e){debugger;return}}if(o){this.fetchItem(o)}else{var t=this.getOwnerComponent().getModel("dropModel");t.setProperty("/SelectedKey","");t.setProperty("/items",[]);t.refresh(true)}},onItemNoChange:function(e){var t=e.getSource();var r=t.getSelectedKey();if(r){this.fetchHtno(r)}else{var s=this.getOwnerComponent().getModel("dropHeat");s.setProperty("/SelectedKey","");s.setProperty("/items",[]);s.refresh(true);var a=this._sFragmentUniqueId;var o=sap.ui.core.Fragment.byId(a,"HtNo");o.setSelectedKey("")}},onBeforeRendering:function(){debugger;if(this.oRouter){this.oRouter.getRoute("operations").detachPatternMatched(this._onObjectMatched,this)}},onAfterRendering:function(){debugger;this.oRouter.getRoute("operations").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(){debugger;this.oRouter.getRoute("operations").detachPatternMatched(this._onObjectMatched,this);var e="zretail_sfl.fragments.front";var t="zretail_sfl.fragments.front";var r=this.getView();var s=r.getController();s.loadFragment(e,t);var a=this.getOwnerComponent().getModel("dropModel");a.setProperty("/SelectedKey","");if(a){a.setProperty("/items",[]);a.refresh(true)}var o=this.getOwnerComponent().getModel("dropHeat");o.setProperty("/SelectedKey","");if(o){o.setProperty("/items",[]);o.refresh(true)}var n=this._sFragmentUniqueId;var i=sap.ui.core.Fragment.byId(n,"HtNo");i.setSelectedKey("")},fetchItem:function(e){debugger;var r=this.getView();var s=new t("/sap/opu/odata/sap/YSD_RETAIL_SO_SRV/");var a=[new sap.ui.model.Filter("InvoiceNo",sap.ui.model.FilterOperator.EQ,e)];var o=this.getOwnerComponent().getModel("dropModel");o.setProperty("/SelectedKey","");o.setProperty("/items",[]);o.refresh(true);s.read("/YSD_RETAIL_DROPSet",{filters:a,success:e=>{debugger;var t=e.results.map(e=>({key:e.Item,text:e.Item}));var r=this.getView().getModel("dropModel");r.setProperty("/items",t);sap.m.MessageToast.show("Data fetched successfully")},error:()=>{sap.m.MessageToast.show("Failed to fetch data")}})},fetchHtno:function(e){debugger;e=e.replace(/\//g,",");var r=this._sFragmentUniqueId;var s=sap.ui.core.Fragment.byId(r,"InvNo")?.getValue();var a=s+","+e;var o=this.getView();var n=new t("/sap/opu/odata/sap/YSD_RETAIL_SO_SRV/");var i=[new sap.ui.model.Filter("HtNo",sap.ui.model.FilterOperator.EQ,a)];var l=this.getOwnerComponent().getModel("dropHeat");l.setProperty("/SelectedKey","");l.setProperty("/items",[]);l.refresh(true);var r=this._sFragmentUniqueId;var d=sap.ui.core.Fragment.byId(r,"HtNo");d.setSelectedKey("");n.read("/YSD_RETAIL_HTNOSet",{filters:i,success:e=>{debugger;var t=e.results.map(e=>({key:e.Item,text:e.Item}));var r=this.getView().getModel("dropHeat");r.setProperty("/items",t);sap.m.MessageToast.show("Data fetched successfully")},error:()=>{sap.m.MessageToast.show("Failed to fetch data")}})},onPushButtonPress:async function(){var e=this._sFragmentUniqueId;var t=sap.ui.core.Fragment.byId(e,"InvNo")?.getValue();var r=sap.ui.core.Fragment.byId(e,"ItemNo")?.getSelectedKey();var s=sap.ui.core.Fragment.byId(e,"HtNo")?.getValue();if(!t||!r||!s){sap.m.MessageToast.show("Please fill in all fields (Invoice No, Item No, and Heat No).");return}r=r.replace(/\//g,",");this._userModel=this.getOwnerComponent().getModel("userModel");let a=localStorage.getItem("userInfo");if(a){let e=JSON.parse(a);this._userModel.setProperty("/",{email:e.email,user:e.user,scopes:e.scopes,given_name:e.user.given_name,family_name:e.user.family_name,user_name:e.user.user_name})}this._userModel=this.getOwnerComponent().getModel("userModel");var o=this._userModel.getProperty("/email");const n=JSON.parse(localStorage.getItem("divisionData"))||{};const i=n.selectedDivision||null;const l=n.selectedSflTile||false;const d=n.selectedTplTile||false;let u=null;let g=null;if(i){g=i}if(l){u="5010"}else if(d){u="6400"}var c=t+","+r+","+s+","+o+","+u+","+g;try{await this.validateData(c)}catch(e){debugger;return}var p=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/YSD_RETAIL_SO_SRV/");var m="pdfViewer-"+(new Date).getTime();var h=new sap.m.PDFViewer({id:m});this.getView().addDependent(h);var f="/sap/opu/odata/sap/YSD_RETAIL_SO_SRV/get_pdfSet('"+c+"')/$value";h.setSource(f);h.setTitle("Test Certificate PDF");h.open()},validateData:async function(e){var r=[new sap.ui.model.Filter("Value",sap.ui.model.FilterOperator.EQ,e)];var s=new t("/sap/opu/odata/sap/YSD_RETAIL_SO_SRV/",{json:true,useBatch:false});return new Promise((e,t)=>{s.read("/TcValidationSet",{method:"GET",filters:r,success:(r,s)=>{debugger;const a=s.data.results;if(a.length>0){var o=a.map(function(e){return e.Value}).join("\n");sap.m.MessageBox.error(o);var n=this._sFragmentUniqueId;var i=sap.ui.core.Fragment.byId(n,"HtNo");i.setSelectedKey("");var l=sap.ui.core.Fragment.byId(n,"InvNo");if(l){l.setValue("")}var d=this.getOwnerComponent().getModel("dropModel");d.setProperty("/SelectedKey","");if(d){d.setProperty("/items",[]);d.refresh(true)}var u=this.getOwnerComponent().getModel("dropHeat");u.setProperty("/SelectedKey","");if(u){u.setProperty("/items",[]);u.refresh(true)}t(s)}else{e(s);sap.m.MessageToast.show("No Errors")}},error:function(e){debugger;t(e)}})})}})});
//# sourceMappingURL=TestCert.js.map