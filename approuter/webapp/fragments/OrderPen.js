sap.ui.define(["zretail_sfl/controller/BaseController","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","zretail_sfl/formatter/formatter"],function(e,t,r,n,a){"use strict";return e.extend("zretail_sfl.controller.OrderPen",{formatter:a,onInit:function(){debugger;this._localModel=this.getOwnerComponent().getModel("mainService");this._readData()},onFragmentLoaded:function(e){debugger;this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("operations").attachPatternMatched(this._onObjectMatched,this);this._localModel=this.getOwnerComponent().getModel("mainService");this._readData()},onBeforeRendering:function(){if(this.oRouter){this.oRouter.getRoute("operations").detachPatternMatched(this._onObjectMatched,this)}},onAfterRendering:function(){this.oRouter.getRoute("operations").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(){debugger;this.oRouter.getRoute("operations").detachPatternMatched(this._onObjectMatched,this);var e="zretail_sfl.fragments.front";var t="zretail_sfl.fragments.front";var r=this.getView();var n=r.getController();n.loadFragment(e,t)},_readData:async function(){debugger;this._userModel=this.getOwnerComponent().getModel("userModel");let e=localStorage.getItem("userInfo");if(e){let t=JSON.parse(e);this._userModel.setProperty("/",{email:t.email,user:t.user,scopes:t.scopes,given_name:t.user.given_name,family_name:t.user.family_name,user_name:t.user.user_name})}this._userModel=this.getOwnerComponent().getModel("userModel");var t=this._userModel.getProperty("/email");const r=JSON.parse(localStorage.getItem("divisionData"))||{};const n=r.selectedDivision||null;const a=r.selectedSflTile||false;const i=r.selectedTplTile||false;let s=null;let o=null;if(n){o=n}if(a){s="5010"}else if(i){s="6400"}const l={email:t,bukrs:s,spart:o};var d=this.getOwnerComponent().getModel("mainService");d.refreshMetadata();d.refresh(true);var g=this._sFragmentUniqueId;this.getView().byId(g+"--__PenOrdTable").setModel(d);sap.ui.core.BusyIndicator.show(0);this.getOwnerComponent().setModel(d,"mainService");const u=this;sap.ui.core.BusyIndicator.show();try{const e=await $.ajax({url:"/nodeapp/ordPenlist",method:"GET",contentType:"application/json",data:l});sap.ui.core.BusyIndicator.hide();const t=e;console.log(t);var c=new sap.ui.model.json.JSONModel;c.setData(t);u.getView().setModel(c,"listModel")}catch(e){sap.ui.core.BusyIndicator.hide();var c=new sap.ui.model.json.JSONModel;c.setData([]);u.getView().setModel(c,"listModel");console.error("Error fetching Order Pending List:",e);const t=e.responseJSON?.error?.innererror?.errordetails?.[0]?.message||"Unknown error occurred"}},onPlant:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__PenOrdTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("Werks",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onSO:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__PenOrdTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("Vbkur",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onSG:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__PenOrdTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("Vkgrp",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onSotp:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__PenOrdTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("Kunnr",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onShtp:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__PenOrdTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("Kunrg",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onPO:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__PenOrdTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("Bstkd",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onDAT:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__PenOrdTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("Bstdk",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onORD:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__PenOrdTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("Vbeln",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onPart:function(e){debugger;var t=this._sFragmentUniqueId;var a=e.getParameter("newValue");var i=this.getView().byId(t+"--__PenOrdTable");var s=i.getBinding("items");var o=[];if(a&&a.length>0){var l=new r("Matnr",n.Contains,a);o.push(new r({filters:[l],and:false}))}s.filter(o)},onDownloadExcel:function(){var e=this.getView().getModel("listModel");var t=e.getProperty("/");if(!t||t.length===0){sap.m.MessageBox.error("No records found to download.");return}var r=t.map(function(e){return{"Sales Office":e.Vbkur,"Sales Group":e.Vkgrp,Region:e.Regio,"Sold-to-Party":e.Kunnr,"Ship-to-Party":e.Kunrg,"PO Reference":e.Bstkd,"PO Date":e.Bstdk,"Sales Order No":e.Vbeln,Item:e.Posnr,"Order Date":e.Erdat,Plant:e.Werks,"Material Number":e.Matnr,"Material Description":e.Maktx,"Pending Quantity":e.Omeng,"Pending Values (in Lakhs)":e.Kbetr,"Sold-to-Party Name":e.Name1,"Ship-to-Party Name":e.Cname1,"Pending for Invoice Quantity":e.Lfimg,"Order Quantity":e.Kwmeng,"Dispatch Quantity":e.DisQty,"Total Pending Quantity":e.TPending,"Order Value":e.Ovalue,"Dispatch Value":e.Dvalue,"Entered Material":e.Matent}});var n=this.convertToCsv(r);var a=new Blob([n],{type:"text/csv;charset=utf-8;"});var i=document.createElement("a");var s=URL.createObjectURL(a);i.setAttribute("href",s);i.setAttribute("download","OrderPend_data.csv");i.style.visibility="hidden";document.body.appendChild(i);i.click();document.body.removeChild(i)},convertToCsv:function(e){var t="";var r=Object.keys(e[0]);t+=r.join(",")+"\r\n";e.forEach(function(e){t+=r.map(function(t){return e[t]?e[t].toString().replace(/,/g," "):""}).join(",")+"\r\n"});return t}})});
//# sourceMappingURL=OrderPen.js.map