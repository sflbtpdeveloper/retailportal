sap.ui.define(["zretail_sfl/controller/BaseController","sap/ui/core/Fragment","sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/HTML"],function(e,t,s,o,i){"use strict";return e.extend("zretail_sfl.controller.welcome",{selectedSflTile:false,selectedTplTile:false,onInit:async function(){var e=this.getView();var t=e.byId("sflTile");var s=e.byId("tplTile");if(t){t.removeStyleClass("selectedTile")}if(s){s.removeStyleClass("selectedTile")}this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("RouteView1").attachPatternMatched(this._onObjectMatched,this);const o=new Date;const i=new sap.ui.model.json.JSONModel({currentDate:o.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})});this.getView().setModel(i,"dateModel");this._userModel=this.getOwnerComponent().getModel("userModel");let l=this;const n=this;let a=[];let r;try{const e=await fetch("/getUserInformation");const t=await e.json();this._userModel.setProperty("/",{email:t.email,user:t.user,scopes:t.scopes,given_name:t.user.given_name,family_name:t.user.family_name,user_name:t.user.user_name});localStorage.setItem("userInfo",JSON.stringify(t));const s=t.email;r=await $.ajax({url:"/nodeapp/accCont",method:"GET",contentType:"application/json",data:{email:s}});const o=Array.isArray(r)?r[0]:r;if(!o||typeof o!=="object"){throw new Error("Invalid response structure")}localStorage.setItem("accessInfo",JSON.stringify(o));const i=o.Sfl==="X";const l=o.Tpl==="X";if(!i&&!l){sap.m.MessageBox.error("No Company Code Maintained")}const n=this.getOwnerComponent().getModel("tileVisibilityModel");n.setProperty("/showSflTile",i);n.setProperty("/showTplTile",l);this.getView().setModel(n,"tileVisibilityModel");const c=["Autolec","Fd","Rca"];c.forEach(e=>{if(o[e]==="X"){a.push(e)}})}catch(e){console.error("Error fetching AccCont data:",e.message)}console.log("Available Divisions:",a);const c={Autolec:"sap-icon://eam-work-order",Fd:"sap-icon://factory",Mfd:"sap-icon://shipping-status",Rca:"sap-icon://add-product",Ukd:"sap-icon://physical-activity",Ad:"sap-icon://action",Asd:"sap-icon://subway-train",Hwf:"sap-icon://technical-object",Sez:"sap-icon://sales-order"};const d={Autolec:"images/AUTOLEC.jpg",Fd:"images/hightensil.png",Rca:"images/hot_forged.jpg"};const u=this.byId("tileContainer");u.removeAllItems();const p={1:"L12 M12 S12",2:"L6 M6 S12",3:"L4 M6 S12"};const g=p[a.length]||"L4 M6 S12";const h=new sap.ui.layout.Grid({defaultSpan:g,hSpacing:1,vSpacing:1,content:a.map(e=>{const t=e.toUpperCase();const s=d[e]||"images/default-image.png";const o=new sap.m.GenericTile({header:t,systemInfo:t,frameType:"OneByHalf",press:this.onDivisionSelect.bind(this)});o.addStyleClass("transparentTile");o.addDelegate({onAfterRendering:function(){const e=o.getDomRef()}});return o})});u.addItem(h);u.setLayoutData(new sap.ui.layout.GridData({span:"L4 M6 S12"}));u.setJustifyContent(sap.m.FlexJustifyContent.Center);u.setAlignItems(sap.m.FlexAlignItems.Center);sap.ui.core.BusyIndicator.hide();const f=new sap.ui.model.json.JSONModel;f.setData(r);n.getView().setModel(f,"AccContModel");var m=this.byId("_IDGenAvatar");m.addEventDelegate({onmouseover:this.onProfileHover.bind(this),onmouseout:this.onProfileMouseOut.bind(this)})},onBeforeRendering:function(){if(this.oRouter){this.oRouter.getRoute("RouteView1").detachPatternMatched(this._onObjectMatched,this)}},onAfterRendering:function(){this.oRouter.getRoute("RouteView1").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(){debugger;var e=this.getView();var t=e.byId("sflTile");var s=e.byId("tplTile");if(t){t.removeStyleClass("selectedTile")}if(s){s.removeStyleClass("selectedTile")}const o=this.getOwnerComponent().getModel("tileSelectedModel");o.setProperty("/selectedTplTile",false);o.setProperty("/selectedSflTile",false)},onDivisionSelect:function(e){debugger;const t=this.getOwnerComponent().getModel("tileSelectedModel");const s=t.getProperty("/selectedSflTile");const o=t.getProperty("/selectedTplTile");if(!s&&!o){sap.m.MessageBox.error("Please select company first and choose division.");return}const i=this.getView().getModel("selectedDivisionModel");i.setProperty("/selectedDivision",e);const l={selectedDivision:e.oSource.mProperties.header,selectedSflTile:s,selectedTplTile:o};localStorage.setItem("divisionData",JSON.stringify(l));this.oRouter.navTo("operations")},onSFLPress:function(){var e=this.getView();var t=e.byId("sflTile");var s=e.byId("tplTile");const o=this.getOwnerComponent().getModel("tileSelectedModel");this.selectedSflTile=true;this.selectedTplTile=false;o.setProperty("/selectedSflTile",this.selectedSflTile);o.setProperty("/selectedTplTile",this.selectedTplTile);const i=JSON.parse(localStorage.getItem("divisionData"))||{};i.selectedSflTile=this.selectedSflTile;i.selectedTplTile=this.selectedTplTile;localStorage.setItem("divisionData",JSON.stringify(i));t.addStyleClass("selectedTile");s.removeStyleClass("selectedTile")},onTPLPress:function(e){var t=this.getView();var s=t.byId("sflTile");var o=t.byId("tplTile");const i=this.getOwnerComponent().getModel("tileSelectedModel");this.selectedTplTile=true;this.selectedSflTile=false;i.setProperty("/selectedTplTile",this.selectedTplTile);i.setProperty("/selectedSflTile",this.selectedSflTile);const l=JSON.parse(localStorage.getItem("divisionData"))||{};l.selectedTplTile=this.selectedTplTile;l.selectedSflTile=this.selectedSflTile;localStorage.setItem("divisionData",JSON.stringify(l));o.addStyleClass("selectedTile");s.removeStyleClass("selectedTile")},onProfileHover:function(e){debugger;var s=this.getView();var o=e.srcControl;var i=JSON.parse(localStorage.getItem("userInfo"))||{};var l=new sap.ui.model.json.JSONModel(i);if(!this._userdetails){t.load({id:s.getId(),name:"zretail_sfl.fragments.userdetails",controller:this}).then(function(e){s.addDependent(e);this._userdetails=e;this._userdetails.setModel(l,"userModel");this._userdetails.openBy(o)}.bind(this))}else{debugger;this._userdetails.setModel(l,"userModel");this._userdetails.openBy(o)}},_loadUserDetails:function(e){this._userModel=this.getOwnerComponent().getModel("userModel");var t=this._userModel.getProperty("/email")},onProfileMouseOut:function(){if(this._userdetails){this._userdetails.close()}},onLogOut:async function(){debugger;const e=await this.getCsrfToken("/nodeapp/custom/logout");$.ajax({type:"POST",url:"/nodeapp/custom/logout",headers:{"X-CSRF-Token":e,"Content-Type":"application/json"},success:function(e){window.location.href=e},error:function(e,t,s){console.error("Logout failed:",s);console.log("Response status:",e.status);console.log("Response text:",e.responseText)}})},getCsrfToken:function(e){return new Promise(function(t,s){$.ajax({type:"GET",url:e,headers:{"X-CSRF-Token":"fetch","Content-Type":"application/json"},success:function(e,s,o){const i=o.getResponseHeader("X-CSRF-Token");debugger;t(i)},error:function(e,t,o){console.error("Failed to fetch CSRF token:",o);s(o)}})})},startSessionTimeout:function(){const e=48e4;let t;const s=()=>{clearTimeout(t);t=setTimeout(()=>{this.onSessionTimeout()},e)};document.addEventListener("mousemove",s);document.addEventListener("keydown",s);s()},onSessionTimeout:function(){sap.m.MessageToast.show("Session has expired due to inactivity.");this.onLogOut()}})});
//# sourceMappingURL=welcome.controller.js.map