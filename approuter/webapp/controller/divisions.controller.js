sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Popup","sap/m/Popover","sap/m/VBox","sap/m/Label","sap/m/Button","sap/m/GenericTile","sap/m/MessageBox","sap/ui/core/Fragment","jquery.sap.global"],function(e,t,o,s,r,a,n,i,l,jQuery){"use strict";return e.extend("zretail_sfl.controller.divisions",{onInit:function(){debugger;this._userModel=this.getOwnerComponent().getModel("userModel");let e=this;fetch("/getUserInformation").then(e=>e.json()).then(t=>{e._userModel.setProperty("/",{email:t.email,user:t.user,scopes:t.scopes,given_name:t.user.given_name,family_name:t.user.family_name,user_name:t.user.user_name});localStorage.setItem("userInfo",JSON.stringify(t));console.log(e._userModel.getProperty("/"))}).catch(e=>console.log(e));this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("operations").attachPatternMatched(this._onObjectMatched,this);var t=this.getView().byId("popover");this._bInsidePopover=true;this._uploadModel=this.getOwnerComponent().getModel("upload");this._reportModel=this.getOwnerComponent().getModel("reports");this._claimModel=this.getOwnerComponent().getModel("claims");this._proprcingModel=this.getOwnerComponent().getModel("propricing");this._infoModel=this.getOwnerComponent().getModel("info");this._dashModel=this.getOwnerComponent().getModel("dashboard");var o=this.getView().byId("_IDGenIconTabHeader");var s=this;o.getItems().forEach(function(e){e.addEventDelegate({onmouseover:function(t){s.onIconTabFilterHover(t,e)},onmouseout:function(t){s.onIconTabFilterOut(t,e)}})});t.attachAfterOpen(function(){var e=t.getDomRef();if(e){e.addEventListener("mouseover",this.onPopoverMouseOver.bind(this));e.addEventListener("mouseout",this.onPopoverMouseOut.bind(this))}}.bind(this));var r=this.byId("_IDGenAvatar1");r.addEventDelegate({onmouseover:this.onProfileHover.bind(this),onmouseout:this.onProfileMouseOut.bind(this)})},dynamicHeader:function(){const e=localStorage.getItem("accessInfo");var t=JSON.parse(e);const o={Upload:"Upload",Reports:"Reports"};const s=["Upload","Reports"];var r=this.getView();var a=r.byId("_IDGenIconTabFilter");var n=r.byId("_IDGenIconTabFilter1");s.forEach(e=>{if(t["Upload"]==="X"){a.setVisible(true)}else{a.setVisible(false)}if(t["Reports"]==="X"){n.setVisible(true)}else{n.setVisible(false)}})},onProfileHover:function(e){debugger;var t=this.getView();var o=e.srcControl;const s=JSON.parse(localStorage.getItem("divisionData"))||{};const r=s.selectedDivision||null;const a=s.selectedSflTile||false;const n=s.selectedTplTile||false;let i=null;let d=null;if(r){d=r}if(a){i="Sundram Fasteners Limited"}else if(n){i="TVS - Sundram Fasteners Limited"}var c=JSON.parse(localStorage.getItem("userInfo"))||{};c.company=i;c.division=d;var f=new sap.ui.model.json.JSONModel(c);if(!this._userdetails){l.load({id:t.getId(),name:"zretail_sfl.fragments.userdetails",controller:this}).then(function(e){t.addDependent(e);this._userdetails=e;this._userdetails.setModel(f,"userModel");this._userdetails.openBy(o)}.bind(this))}else{debugger;this._userdetails.setModel(f,"userModel");this._userdetails.openBy(o)}},_loadUserDetails:function(e){this._userModel=this.getOwnerComponent().getModel("userModel");var t=this._userModel.getProperty("/email")},onProfileMouseOut:function(){if(this._userdetails){this._userdetails.close()}},onAfterRendering:function(){this.oRouter.getRoute("operations").attachPatternMatched(this._onObjectMatched,this)},onBeforeRendering:function(){if(this.oRouter){this.oRouter.getRoute("operations").detachPatternMatched(this._onObjectMatched,this)}},_onObjectMatched:function(){debugger;this.oRouter.getRoute("operations").detachPatternMatched(this._onObjectMatched,this);var e="zretail_sfl.fragments.front";var t="zretail_sfl.fragments.front";this.loadFragment(e,t);this.dynamicHeader()},onTabSelect:function(e,t){var o;var s;var r=e.getParameter("key");if(r==="Home"){o="zretail_sfl.fragments.front";s="zretail_sfl.fragments.front";this.loadFragment(o,s)}if(sap.ui.Device.system.phone||sap.ui.Device.system.tablet){var a=this.getView().byId("_IDGenIconTabHeader");var n=this._uploadModel;var i=this._reportModel;var l=this._claimModel;var d=this._proprcingModel;var c=this._infoModel;var f=this._dashModel;var u=this.getView().byId("popover");var p=this;switch(t.mProperties.key){case"Upload":p.getView().byId("idList").setModel(n,"localData");break;case"Reports":p.getView().byId("idList").setModel(i,"localData");break;case"Claims":p.getView().byId("idList").setModel(l,"localData");break;case"Products":p.getView().byId("idList").setModel(d,"localData");break;case"Info":p.getView().byId("idList").setModel(c,"localData");break;case"Dash":p.getView().byId("idList").setModel(f,"localData");break;default:oList.setModel(null)}var g=[];a.getItems().forEach(function(e){var t=e.getDomRef();if(t&&t.offsetParent!==null){g.push(e)}});var m=a.mProperties.selectedKey;var h=g.find(function(e){return e.getKey()===m});if(h){a.setSelectedKey(m);this._bInsidePopover=true;u.openBy(h)}}},onIconTabFilterHover:async function(e,t){var o=this.getView().byId("_IDGenIconTabHeader");var s=this._uploadModel;var r=this._reportModel;var a=this._claimModel;var n=this._proprcingModel;var i=this._infoModel;var l=this._dashModel;let d=[];const c=localStorage.getItem("accessInfo");var f=JSON.parse(c);var u=this.getView().byId("popover");var p=this;switch(t.mProperties.key){case"Upload":const e={OrderUpl:"Order Upload",GRNUpl:"GRN Upload",StradeUpl:"Sales to Trade Upload",StockUpl:"Stock Upload"};const t=["OrderUpl","GRNUpl","StradeUpl","StockUpl"];t.forEach(t=>{if(f[t]==="X"||f[t]===true){d.push(e[t])}});const o=d.map(e=>({key:e,text:e}));const s=new sap.ui.model.json.JSONModel({items:o});p.getView().byId("idList").setModel(s,"localData");break;case"Reports":const r={OrderAck:"Order Acknowledgement",Pending:"Pending Order Status",Dispatch:"Dispatch Status",Grn:"GRN Status",TestCert:"Test Certificate",StockInfo:"SFL Stock Information",PriceUpl:"Price List",PayOutst:"Payment Outstanding"};const c=["OrderAck","Pending","Dispatch","Grn","TestCert","StockInfo","PriceUpl","PayOutst"];c.forEach(e=>{if(f[e]==="X"||f[e]===true){d.push(r[e])}});const u=d.map(e=>({key:e,text:e}));const g=new sap.ui.model.json.JSONModel({items:u});p.getView().byId("idList").setModel(g,"localData");break;case"Claims":p.getView().byId("idList").setModel(a,"localData");break;case"Products":p.getView().byId("idList").setModel(n,"localData");break;case"Info":p.getView().byId("idList").setModel(i,"localData");break;case"Dash":p.getView().byId("idList").setModel(l,"localData");break;default:oList.setModel(null)}var g=[];o.getItems().forEach(function(e){var t=e.getDomRef();if(t&&t.offsetParent!==null){g.push(e)}});var m=t.mProperties.key;var h=g.find(function(e){return e.getKey()===m});if(h){o.setSelectedKey(t.getKey());this._bInsidePopover=true;u.openBy(h)}},onIconTabFilterOut:function(e,t){var o=this.getView().byId("popover");this._bInsidePopover=false;setTimeout(function(){if(!this._bInsidePopover){o.close()}}.bind(this),1e3)},onPopoverMouseOver:function(e){this._bInsidePopover=true},onPopoverMouseOut:function(){var e=this.getView().byId("popover");this._bInsidePopover=false;setTimeout(function(){if(!this._bInsidePopover){e.close()}}.bind(this),100)},onPress:function(e){var t;var o;var s;var r=this.getView();var a=r.byId("fragmentContainer");a.removeAllItems();var n=e.oSource.mProperties.title;if(n==="Order Upload"){t="zretail_sfl.fragments.OrderUpload";o="zretail_sfl.fragments.OrderUpload"}else if(n==="GRN Upload"){t="zretail_sfl.fragments.GrnUpload";o="zretail_sfl.fragments.GrnUpload"}else if(n==="Sales to Trade Upload"){t="zretail_sfl.fragments.SalesToTrade";o="zretail_sfl.fragments.SalesToTrade"}else if(n==="Stock Upload"){t="zretail_sfl.fragments.StkUpload";o="zretail_sfl.fragments.StkUpload"}else if(n==="Order Acknowledgement"){t="zretail_sfl.fragments.OrderAck";o="zretail_sfl.fragments.CFOrderAck"}else if(n==="Pending Order Status"){t="zretail_sfl.fragments.OrderPen";o="zretail_sfl.fragments.OrderPen"}else if(n==="Dispatch Status"){t="zretail_sfl.fragments.OrderDes";o="zretail_sfl.fragments.OrderDes"}else if(n==="GRN Status"){t="zretail_sfl.fragments.StkUpload";o="zretail_sfl.fragments.StkUpload"}else if(n==="Test Certificate"){t="zretail_sfl.fragments.StkUpload";o="zretail_sfl.fragments.StkUpload"}else if(n==="SFL Stock Information"){t="zretail_sfl.fragments.StkRep";o="zretail_sfl.fragments.StkRep"}else if(n==="Price List"){t="zretail_sfl.fragments.Price";o="zretail_sfl.fragments.Price"}else if(n==="Payment Outstanding"){t="zretail_sfl.fragments.StkUpload";o="zretail_sfl.fragments.StkUpload"}else{t="zretail_sfl.fragments.front";o="zretail_sfl.fragments.front"}this.loadFragment(t,o)},loadView:function(e){var t=this.getView();var o=t.byId("fragmentContainer");o.removeAllItems();sap.ui.core.mvc.XMLView.create({viewName:e}).then(function(e){o.addItem(e)}).catch(function(e){console.error("Error loading view:",e)})},onAboutUsPress:function(){window.open("https://sundram.com/about-us.php","_blank")},onContactsPress:function(){window.open("https://sundram.com/contact-us.php","_blank")},onEventsPress:function(){window.open("https://www.sundram.com/awards.php","_blank")},onNewsPress:function(){window.open("https://www.sundram.com/esgreport.php","_blank")},loadFragment:function(e,t){var o=this.getView();var s=o.byId("fragmentContainer");sap.ui.require([t.replace(/\./g,"/")],function(t){console.log(t);if(typeof t==="function"){var r=new t;r.getView=function(){return o}}else{console.error("Controller is not a valid function")}s.removeAllItems();var a=o.createId(e+"_"+Date.now());l.load({id:a,name:e,controller:r}).then(function(t){s.addItem(t);r._sFragmentUniqueId=a;var o=["zretail_sfl.fragments.SalesToTrade","zretail_sfl.fragments.OrderAck","zretail_sfl.fragments.OrderPen","zretail_sfl.fragments.OrderDes","zretail_sfl.fragments.StkRep","zretail_sfl.fragments.Price"];if(o.includes(e)){if(typeof r.onFragmentLoaded==="function"){r.onFragmentLoaded(t)}}else{r.onInit(t)}})})},onLogOut:async function(){debugger;const e=await this.getCsrfToken("/nodeapp/custom/logout");$.ajax({type:"POST",url:"/nodeapp/custom/logout",headers:{"X-CSRF-Token":e,"Content-Type":"application/json"},success:function(e){window.location.href=e},error:function(e,t,o){console.error("Logout failed:",o);console.log("Response status:",e.status);console.log("Response text:",e.responseText)}})},getCsrfToken:function(e){return new Promise(function(t,o){$.ajax({type:"GET",url:e,headers:{"X-CSRF-Token":"fetch","Content-Type":"application/json"},success:function(e,o,s){const r=s.getResponseHeader("X-CSRF-Token");debugger;t(r)},error:function(e,t,s){console.error("Failed to fetch CSRF token:",s);o(s)}})})},startSessionTimeout:function(){const e=24e4;let t;const o=()=>{clearTimeout(t);t=setTimeout(()=>{this.onSessionTimeout()},e)};document.addEventListener("mousemove",o);document.addEventListener("keydown",o);o()},onSessionTimeout:function(){sap.m.MessageToast.show("Session has expired due to inactivity.");this.onLogOut()}})});
//# sourceMappingURL=divisions.controller.js.map